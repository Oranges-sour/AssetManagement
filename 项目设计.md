# 公司资产管理系统（实践作业）设计文档

## 目录
1. 项目概述
2. 需求分析
3. 总体设计
4. 数据库设计
5. API 接口设计
6. 关键业务流程
7. 异常与错误码规范
8. 部署与运行说明
9. 测试计划（简要）
10. 附录（字段说明）

## 1. 项目概述

本系统用于维护公司资产信息，实现对 **部门、位置空间、资产、领用人** 四类数据的增删改查，并支持资产的 **领用/归还** 基本业务操作。
系统采用前后端分离，前端为单页面应用（SPA），后端基于 Servlet 与 JDBC 实现 REST 风格接口。

## 2. 需求分析

### 2.1 功能需求

系统包含四个模块：

#### 2.1.1 部门管理模块
- 维护部门信息：新增、查询、修改、删除
- 部门信息包括：部门编码、部门名称、备注
- 支持查看部门下的位置空间（用于关联展示或下拉选择）

#### 2.1.2 位置空间管理模块
- 维护位置空间信息：新增、查询、修改、删除
- 信息包括：所属部门、房间号、面积、备注
- 支持按部门筛选位置空间

#### 2.1.3 资产管理模块
- 维护资产信息：新增、查询、修改、删除
- 信息包括：资产编号、名称、价值、存放位置、领用人（可为空）、状态、备注
- 支持资产 **领用** 与 **归还**
- 支持多条件筛选（关键字/部门/位置/领用人/状态）

#### 2.1.4 领用人管理模块
- 维护领用人信息：新增、查询、修改、删除
- 信息包括：工号、姓名、电话（可选）、备注
- 支持查看领用人名下资产列表（关联展示）

### 2.2 非功能需求（实践作业级）
- 响应数据统一为 JSON 格式
- 支持分页查询
- 中文不乱码（UTF-8）
- 前后端分离支持跨域（CORS）
- 数据一致性：删除操作需遵循约束规则（避免误删关联数据）

## 3. 总体设计

### 3.1 系统架构
- 前端：Vue3 SPA，通过 Router 切换模块页面，使用 Pinia 管理列表数据与筛选条件
- 后端：Tomcat 部署 Servlet，按资源划分 4 个主要 Servlet
- 数据库：MySQL 保存业务数据

### 3.2 模块划分与职责

#### 前端模块
- 部门管理页面：部门列表、搜索分页、新增/编辑弹窗、删除
- 位置空间管理页面：位置列表、按部门筛选、CRUD
- 资产管理页面：资产列表、多条件筛选、CRUD、领用/归还
- 领用人管理页面：领用人列表、CRUD、查看名下资产

#### 后端模块（建议分层）
- Controller（Servlet）：参数解析、调用 Service、返回 JSON
- Service：业务规则（删除前校验、领用/归还逻辑）
- DAO：JDBC 访问数据库（SQL + PreparedStatement）
- 防止 SQL 注入
- Model：实体对象（Department/LocationSpace/Asset/Assignee）

### 3.3 核心数据关系
- 部门（1）——（N）位置空间
- 位置空间（1）——（N）资产
- 领用人（1）——（N）资产（资产可无领用人）

## 4. 数据库设计

### 4.1 数据库与字符集建议
- 数据库名：`orange_db`
- 引擎：InnoDB
- 字符集：utf8mb4

### 4.2 表结构（DDL）

#### 4.2.1 部门表：department
```sql
CREATE TABLE department (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  dept_code VARCHAR(32) NOT NULL UNIQUE,
  dept_name VARCHAR(64) NOT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 4.2.2 位置空间表：location_space
```sql
CREATE TABLE location_space (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  dept_id BIGINT NOT NULL,
  room_no VARCHAR(32) NOT NULL,
  area DECIMAL(10,2) NOT NULL DEFAULT 0.00,
  remark VARCHAR(255) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_location_dept_id (dept_id),
  UNIQUE KEY uk_dept_room (dept_id, room_no),
  CONSTRAINT fk_location_dept
    FOREIGN KEY (dept_id) REFERENCES department(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 4.2.3 领用人表：assignee
```sql
CREATE TABLE assignee (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  emp_no VARCHAR(32) NOT NULL UNIQUE,
  name VARCHAR(64) NOT NULL,
  phone VARCHAR(32) DEFAULT NULL,
  remark VARCHAR(255) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

#### 4.2.4 资产表：asset
```sql
CREATE TABLE asset (
  id BIGINT PRIMARY KEY AUTO_INCREMENT,
  asset_no VARCHAR(32) NOT NULL UNIQUE,
  asset_name VARCHAR(64) NOT NULL,
  value DECIMAL(12,2) NOT NULL DEFAULT 0.00,
  location_id BIGINT NOT NULL,
  assignee_id BIGINT DEFAULT NULL,
  status TINYINT NOT NULL DEFAULT 0 COMMENT '0=闲置,1=领用',
  remark VARCHAR(255) DEFAULT NULL,
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_asset_location (location_id),
  INDEX idx_asset_assignee (assignee_id),
  INDEX idx_asset_status (status),
  CONSTRAINT fk_asset_location
    FOREIGN KEY (location_id) REFERENCES location_space(id),
  CONSTRAINT fk_asset_assignee
    FOREIGN KEY (assignee_id) REFERENCES assignee(id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
```

## 5. API 接口设计

### 5.1 通用约定

#### 5.1.1 Base URL
`/api`

#### 5.1.2 响应格式
```json
{ "code": 0, "msg": "ok", "data": null }
```

#### 5.1.3 分页参数与返回
请求参数：`page`（从 1 开始）、`size`

返回：
```json
{
  "code": 0,
  "msg": "ok",
  "data": { "list": [], "page": 1, "size": 10, "total": 0 }
}
```

#### 5.1.4 健康检查（无业务功能）
用于检测后端服务是否存活。

`GET /api/health`

成功返回：
```json
{ "code": 0, "msg": "ok", "data": { "status": "UP" } }
```

### 5.2 部门 Department

#### 新增部门
`POST /api/departments`

请求示例：
```json
{ "deptCode": "D001", "deptName": "行政部", "remark": "可选" }
```

#### 修改部门
`PUT /api/departments/{id}`

#### 删除部门
`DELETE /api/departments/{id}`

业务限制：部门下存在位置空间则禁止删除。

#### 部门详情
`GET /api/departments/{id}`

#### 部门列表（分页+关键字）
`GET /api/departments?keyword=&page=1&size=10`

### 5.3 位置空间 Location Space

#### 新增位置空间
`POST /api/locations`

请求示例：
```json
{ "deptId": 1, "roomNo": "A-301", "area": 60.50, "remark": "" }
```

#### 修改位置空间
`PUT /api/locations/{id}`

#### 删除位置空间
`DELETE /api/locations/{id}`

业务限制：位置空间下存在资产则禁止删除。

#### 位置空间详情
`GET /api/locations/{id}`

#### 位置空间列表（分页+筛选）
`GET /api/locations?deptId=&keyword=&page=1&size=10`

#### 部门下位置空间（用于下拉框）
`GET /api/departments/{deptId}/locations`

响应 `data` 示例：
```json
[{ "id": 10, "roomNo": "A-301" }]
```

### 5.4 领用人 Assignee

#### 新增领用人
`POST /api/assignees`

请求示例：
```json
{ "empNo": "E1001", "name": "张三", "phone": "13800000000", "remark": "" }
```

#### 修改领用人
`PUT /api/assignees/{id}`

#### 删除领用人
`DELETE /api/assignees/{id}`

业务限制：名下存在资产则禁止删除。

#### 领用人详情
`GET /api/assignees/{id}`

#### 领用人列表（分页+关键字）
`GET /api/assignees?keyword=&page=1&size=10`

#### 领用人名下资产（关联展示）
`GET /api/assignees/{id}/assets?page=1&size=10`

### 5.5 资产 Asset

#### 新增资产
`POST /api/assets`

请求示例：
```json
{
  "assetNo": "AS0001",
  "assetName": "笔记本电脑",
  "value": 8000.00,
  "locationId": 10,
  "assigneeId": null,
  "remark": ""
}
```

#### 修改资产
`PUT /api/assets/{id}`

#### 删除资产
`DELETE /api/assets/{id}`

#### 资产详情
`GET /api/assets/{id}`

#### 资产列表（分页+多条件）
`GET /api/assets?keyword=&deptId=&locationId=&assigneeId=&status=&page=1&size=10`

列表建议返回 join 后的显示字段（`roomNo`、`deptName`、`assigneeName`），减少前端二次查询。

#### 资产领用
`POST /api/assets/{id}/assign`

请求示例：
```json
{ "assigneeId": 3 }
```

#### 资产归还
`POST /api/assets/{id}/return`

## 6. 关键业务流程

### 6.1 基础数据初始化流程（推荐演示顺序）
1. 新增部门（D001 行政部）
2. 在该部门下新增位置空间（A-301，60.5㎡）
3. 新增领用人（E1001 张三）
4. 新增资产（AS0001 笔记本电脑，位置 A-301，初始闲置）
5. 资产领用：对 AS0001 执行 assign → 绑定张三，状态变为领用
6. 资产归还：对 AS0001 执行 return → 领用人置空，状态变为闲置

### 6.2 删除限制流程说明
- 删除部门前：先检查 `location_space` 是否存在 `dept_id` 对应记录
- 删除位置空间前：先检查 `asset` 是否存在 `location_id` 对应记录
- 删除领用人前：先检查 `asset` 是否存在 `assignee_id` 对应记录

## 7. 异常与错误码规范

| 错误码 | 含义 | 示例场景 |
| --- | --- | --- |
| 0 | 成功 | 正常返回 |
| 4001 | 参数错误 | 缺少必填字段/格式不合法 |
| 4002 | 业务规则限制 | 删除被阻止、状态不允许 |
| 4004 | 数据不存在 | 根据 id 查询/更新/删除不存在 |
| 4090 | 唯一键冲突 | deptCode/empNo/assetNo 重复 |
| 5000 | 服务器异常 | JDBC 异常、未捕获异常 |

失败响应示例：
```json
{ "code": 4002, "msg": "该位置空间下存在资产，禁止删除", "data": null }
```

## 8. 部署与运行说明

### 8.1 运行环境
- JDK 8
- Tomcat 9.x
- MySQL 5.7/8.0 均可

### 8.2 部署步骤（概述）
1. 创建数据库 `asset_db`，执行建表 SQL
2. 配置数据库连接信息（如 `db.properties`）
3. Maven 打包为 war
4. 将 war 放入 Tomcat 的 webapps 并启动
5. 前端配置后端 baseURL，进行联调

## 9. 测试计划（简要）

### 9.1 CRUD 测试
- 部门、位置空间、资产、领用人：新增/查询/修改/删除是否成功
- 唯一字段重复是否提示 4090

### 9.2 关联与业务规则测试
- 部门下有位置空间 → 删除部门应失败（4002）
- 位置空间下有资产 → 删除位置空间应失败（4002）
- 领用人名下有资产 → 删除领用人应失败（4002）

### 9.3 资产领用/归还测试
- 闲置资产 assign 后：`assignee_id` 非空、`status=1`
- 领用资产 return 后：`assignee_id` 置空、`status=0`
- 列表筛选 `status` 是否正确

## 10. 附录：字段说明（简表）

### 10.1 department
- dept_code：部门编码（唯一）
- dept_name：部门名称

### 10.2 location_space
- dept_id：所属部门
- room_no：房间号（同部门内唯一）
- area：面积（>=0）

### 10.3 assignee
- emp_no：工号（唯一）
- name：姓名

### 10.4 asset
- asset_no：资产编号（唯一）
- asset_name：资产名称
- value：价值（>=0）
- location_id：存放位置（必填）
- assignee_id：领用人（可为空）
- status：0 闲置 / 1 领用（与 `assignee_id` 保持一致）
